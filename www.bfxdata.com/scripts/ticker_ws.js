function startTime(){var e=new Date,t=e.getUTCHours(),a=e.getMinutes(),o=e.getSeconds();t=checkTime(t),a=checkTime(a),o=checkTime(o),document.getElementById("clock").innerHTML=t+":"+a+":"+o+" (UTC)&nbsp &nbsp &nbsp;";setTimeout(function(){startTime()},500)}function checkTime(e){return 10>e&&(e="0"+e),e}function startwebsocketio(){socket=io.connect("https://bfxdata.com:3001",{secure:!0}),socket.on("connect",function(){socket.emit("adduser",randomUsername())}),socket.on("dataupdate",function(e,t){try{jsonObject=t,jsonObject=JSON.parse(jsonObject)}catch(a){}try{var o=Object.keys(jsonObject);"ticker_rt"==o&&(t=jsonObject[o],updateTickerValues(t))}catch(a){}})}function bfxdataToday(){$.ajax({url:"json/bfxdataToday.json",success:function(data){data=eval(data),updateValues(data)},cache:!1})}function bfxdataToday1minute(){$.ajax({url:"json/bfxdataToday1Minute.json",success:function(data){data=eval(data),updateValues(data),bfxdataTodayloaded=!0},cache:!1})}function randomUsername(){for(var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",t=8,a="user_",o=0;t>o;o++){var n=Math.floor(Math.random()*e.length);a+=e.substring(n,n+1)}str=window.location.href,str=str.replace("https://www.bfxdata.com/",""),str=str.replace("https://bfxdata.com/",""),str=str.replace("http://www.bfxdata.com/",""),str=str.replace("http://bfxdata.com/",""),str=str.replace(/\//g,"_"),a+="_"+str;var s=new Date,c=s.getTime();return a+="_"+c}function updateTicker(){$.ajax({url:"../json/ticker_rt.json",type:"GET",dataType:"json",timeout:3e3,cache:!1,success:function(data){data=eval(data),updateTickerValues(data),tickerLoaded=!0},error:function(e,t){console.log("timeout"===t?"Error: ticker datarequest timeout":"Error: "+t)}})}function updateTickerValue(e,t){var a="#"+e;t=parseFloat(t);for(var o=$(a).text();-1!=o.indexOf(",");)o=o.replace(",","");o=parseFloat(o);var n=e.substr(e.length-6);if("BTCUSD"==n)var s=3;else if("LTCUSD"==n)var s=5;else if("BTCCNY"==n)var s=2;else if("LTCCNY"==n)var s=2;else var s=1;t>o&&(tickerLoaded&&$(a).css("color","green"),$(a).html(formatTickerNumber(t,s))),o>t&&(tickerLoaded&&$(a).css("color","red"),$(a).html(formatTickerNumber(t,s)))}function updateTickerValues(e){jQuery.each(e,function(e,t){updatedValue=t,updateTickerValue(e,updatedValue)})}function formatTickerNumber(e,t){e=e.toFixed(t)+"",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1,$2");return x1+x2}function updateValue(e,t){var a="#"+e;t=parseFloat(t);for(var o=$(a).text();-1!=o.indexOf(",");)o=o.replace(",","");o=parseFloat(o);var n=e.substr(0,e.length-6);if("priceBTCUSD"==e||"bidBTCUSD"==e||"askBTCUSD"==e||"minBTCUSD"==e||"maxBTCUSD"==e||"maxBTCUSD"==e||"volex"==n||"change24rel"==n||"volumeChange"==n||"vwap24BTCUSD"==e||"change24absBTCUSD"==e||"maxBTCUSD"==e)var s=3;else if("todayVolume"==n||"volumeWeek"==n||"volumeMonth"==n||"swapVolume1hUSD"==e||"swapVolume1hBTC"==e||"swapVolume1hLTC"==e||"swapVolume24hUSD"==e||"swapVolume24hBTC"==e||"swapVolume24hLTC"==e)var s=2;else if("changeAbsoluteTotalAvgRateUSD"==e||"changeAbsoluteTotalAvgRateBTC"==e||"changeAbsoluteTotalAvgRateLTC"==e)var s=7;else if("totalAmountUSD"==e||"totalAmountBTC"==e||"totalAmountLTC"==e||"changeAbsoluteTotalAmountUSD"==e||"changeAbsoluteTotalAmountBTC"==e||"changeAbsoluteTotalAmountLTC"==e)var s=0;else var s=5;t>o&&(bfxdataTodayloaded&&($(a).parent().parent().animate({backgroundColor:"rgba(90,151,112,0.3)"},300),$(a).parent().parent().animate({backgroundColor:"rgba(255,255,255,0)"},3e3)),$(a).html("change24rel"==n||"volumeChange"==n||"lastSwapUSD"==e||"lastSwapBTC"==e||"lastSwapLTC"==e?formatNumber(t,s)+" %":formatNumber(t,s))),o>t&&(bfxdataTodayloaded&&($(a).parent().parent().animate({backgroundColor:"rgba(204,63,51,0.3)"},300),$(a).parent().parent().animate({backgroundColor:"rgba(255,255,255,0)"},3e3)),$(a).html("change24rel"==n||"volumeChange"==n||"lastSwapUSD"==e||"lastSwapBTC"==e||"lastSwapLTC"==e?formatNumber(t,s)+" %":formatNumber(t,s))),("change24rel"==n||"volumeChange"==n||"change24abs"==n||"changeAbsoluteTotalAmountUSD"==e||"changeAbsoluteTotalAmountBTC"==e||"changeAbsoluteTotalAmountLTC"==e||"changeAbsoluteTotalAvgRateUSD"==e||"changeAbsoluteTotalAvgRateBTC"==e||"changeAbsoluteTotalAvgRateLTC"==e)&&changeFontColor(a,t)}function updateValues(e){jQuery.each(e,function(e,t){updatedValue=t[0],updateValue(e,updatedValue)})}function changeFontColor(e,t){t>0&&$(e).css("color","green"),0>t&&$(e).css("color","red")}function formatNumber(e,t){e=e.toFixed(t)+"",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1,$2");return x1+x2}function startwebsocket(){var e="ws://bfxdata.com:2207/echobot";try{socket=new WebSocket(e),console.log("WebSocket - status "+socket.readyState),socket.onopen=function(){console.log("Welcome - status "+this.readyState)},socket.onmessage=function(e){console.log("Received: "+e.data),jsonObject=e.data,jsonObject=JSON.parse(jsonObject),console.log("parsed: "+jsonObject),console.log("typof: "+typeof jsonObject),console.log("message: "+jsonObject.message),messageJson=JSON.stringify(jsonObject.message),console.log("json stringfy: "+messageJson);try{var t=Object.keys(jsonObject.message);console.log("json keyname: "+t[0]),"ticker"==t&&(ticker=jsonObject.message[t],updateTickerValues(ticker)),("bfxdataToday"==t||"bfxdataToday1Minute"==t)&&(data=jsonObject.message[t],updateValues(data))}catch(a){}},socket.onclose=function(){console.log("Disconnected - status "+this.readyState)}}catch(t){console.log(t)}$("msg").focus()}function send(){var e,t;if(e=$("msg"),t=e.value,!t)return void alert("Message can not be empty");e.value="",e.focus();try{socket.send(t),console.log("Sent: "+t)}catch(a){log(a)}}function quit(){null!=socket&&(console.log("Goodbye!"),socket.close(),socket=null)}function reconnect(){quit(),init()}var tickerLoaded=!1,socket;$(document).ready(function(){updateTicker(),startwebsocketio(),startTime()});